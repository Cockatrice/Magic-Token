name: XML Validation

on:
  push:
    branches: [ master ]
    paths:
      - '.github/workflows/validation.yml'
      - '**.xml'
  pull_request:
    branches: [ master ]
    paths:
      - '.github/workflows/validation.yml'
      - '**.xml'
  workflow_dispatch:
  schedule:
    # Runs at the start of each month (UTC)
    - cron: '0 0 1 * *'

jobs:
  validate-xml:
    name: 'xmllint'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install dependencies
        run: sudo apt-get install libxml2-utils

      - name: Enable problem matcher
        uses: korelstar/xmllint-problem-matcher@v1

      - name: Download and validate XSD schema for card database v4
        id: xsd
        run: |
          wget https://www.w3.org/2012/04/XMLSchema.xsd    # Download XSD meta schema to validate xsd files against
          wget https://raw.githubusercontent.com/Cockatrice/Cockatrice/master/doc/carddatabase_v4/cards.xsd -O carddb_v4.xsd
          xmllint --noout --schema XMLSchema.xsd carddb_v4.xsd

      - name: Validate tokens.xml
        if: steps.xsd.outcome == 'success'
        run: |
          xmllint --noout --schema carddb_v4.xsd tokens.xml

      - name: Validate challenge_tokens.xml
        if: steps.xsd.outcome == 'success'
        run: |
          xmllint --noout --schema carddb_v4.xsd challenge_tokens.xml
